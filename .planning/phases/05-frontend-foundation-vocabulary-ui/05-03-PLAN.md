---
phase: 05-frontend-foundation-vocabulary-ui
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/features/vocabulary/schemas/vocabularySchemas.ts
  - frontend/src/features/vocabulary/api/useCreateVocabulary.ts
  - frontend/src/features/vocabulary/api/useUpdateVocabulary.ts
  - frontend/src/features/vocabulary/api/useDeleteVocabulary.ts
  - frontend/src/features/vocabulary/components/VocabularyForm.tsx
  - frontend/src/features/vocabulary/components/CreateVocabularyModal.tsx
  - frontend/src/features/vocabulary/components/EditVocabularyModal.tsx
  - frontend/src/features/vocabulary/components/DeleteConfirmDialog.tsx
  - frontend/src/features/vocabulary/api/useVocabularyDetail.ts
  - frontend/src/components/ui/Modal.tsx
autonomous: true

must_haves:
  truths:
    - "User can add new vocabulary entry via form with word form, translation, and notes fields"
    - "User can edit existing vocabulary entry including lemma text, translation, notes, and inflections"
    - "User can delete vocabulary entry with confirmation dialog"
    - "Form validation prevents submission of empty required fields"
    - "Successful mutations invalidate vocabulary queries for fresh data"
  artifacts:
    - path: "frontend/src/features/vocabulary/schemas/vocabularySchemas.ts"
      provides: "Zod validation schemas for create and update forms"
      contains: "z.object"
    - path: "frontend/src/features/vocabulary/api/useCreateVocabulary.ts"
      provides: "TanStack Query mutation for creating vocabulary"
      contains: "useMutation"
    - path: "frontend/src/features/vocabulary/components/VocabularyForm.tsx"
      provides: "Reusable form component for create and edit"
      contains: "useForm"
    - path: "frontend/src/components/ui/Modal.tsx"
      provides: "Reusable modal/dialog component"
      contains: "dialog"
  key_links:
    - from: "frontend/src/features/vocabulary/api/useCreateVocabulary.ts"
      to: "/api/vocabulary"
      via: "axios POST request"
      pattern: "post.*vocabulary"
    - from: "frontend/src/features/vocabulary/components/VocabularyForm.tsx"
      to: "frontend/src/features/vocabulary/schemas/vocabularySchemas.ts"
      via: "zodResolver import"
      pattern: "zodResolver"
    - from: "frontend/src/features/vocabulary/api/useCreateVocabulary.ts"
      to: "vocabulary query invalidation"
      via: "queryClient.invalidateQueries"
      pattern: "invalidateQueries.*vocabulary"
---

<objective>
Build vocabulary CRUD forms (create, edit, delete) with React Hook Form + Zod validation and TanStack Query mutations.

Purpose: Delivers create (success criteria 5), edit (criteria 6), and delete (criteria 7) vocabulary management capabilities with proper form validation and optimistic cache invalidation.
Output: Create modal with validated form, edit modal with pre-populated form, delete confirmation dialog, and TanStack Query mutation hooks for all three operations.
</objective>

<execution_context>
@/Users/kevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-frontend-foundation-vocabulary-ui/05-RESEARCH.md
@.planning/phases/05-frontend-foundation-vocabulary-ui/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Zod schemas, mutation hooks, Modal component, and detail fetch hook</name>
  <files>
    frontend/src/features/vocabulary/schemas/vocabularySchemas.ts
    frontend/src/features/vocabulary/api/useCreateVocabulary.ts
    frontend/src/features/vocabulary/api/useUpdateVocabulary.ts
    frontend/src/features/vocabulary/api/useDeleteVocabulary.ts
    frontend/src/features/vocabulary/api/useVocabularyDetail.ts
    frontend/src/components/ui/Modal.tsx
  </files>
  <action>
    **1. Create Zod validation schemas** (`frontend/src/features/vocabulary/schemas/vocabularySchemas.ts`):

    Create schema:
    ```typescript
    export const createVocabularySchema = z.object({
      wordForm: z.string().min(1, 'Word form is required').max(100, 'Word form too long'),
      translation: z.string().min(1, 'Translation is required').max(200, 'Translation too long'),
      notes: z.string().max(5000, 'Notes too long').optional().or(z.literal('')),
    });
    export type CreateVocabularyFormData = z.infer<typeof createVocabularySchema>;
    ```

    Update schema (includes inflections):
    ```typescript
    const inflectionUpdateSchema = z.object({
      id: z.number().optional(),
      form: z.string().min(1, 'Form is required').max(100),
      grammaticalInfo: z.string().max(100).optional().or(z.literal('')),
    });

    export const updateVocabularySchema = z.object({
      text: z.string().min(1, 'Lemma text is required').max(100, 'Text too long'),
      translation: z.string().min(1, 'Translation is required').max(200, 'Translation too long'),
      notes: z.string().max(5000, 'Notes too long').optional().or(z.literal('')),
      inflections: z.array(inflectionUpdateSchema).optional(),
    });
    export type UpdateVocabularyFormData = z.infer<typeof updateVocabularySchema>;
    ```

    **2. Create useCreateVocabulary mutation hook** (`frontend/src/features/vocabulary/api/useCreateVocabulary.ts`):
    - `useMutation` with mutationFn: POST `/api/vocabulary` with CreateLemmaRequest body
    - Returns `LemmaDetailDTO`
    - `onSuccess`: invalidate all queries with key starting with `['vocabulary']`
    - Export the hook function

    **3. Create useUpdateVocabulary mutation hook** (`frontend/src/features/vocabulary/api/useUpdateVocabulary.ts`):
    - `useMutation` with mutationFn: PUT `/api/vocabulary/{id}` with UpdateLemmaRequest body
    - Takes `{ id: number; data: UpdateLemmaRequest }` as variables
    - Returns `LemmaDetailDTO`
    - `onSuccess`: invalidate `['vocabulary']` queries AND `['vocabulary', id]` detail query

    **4. Create useDeleteVocabulary mutation hook** (`frontend/src/features/vocabulary/api/useDeleteVocabulary.ts`):
    - `useMutation` with mutationFn: DELETE `/api/vocabulary/{id}`
    - Takes `id: number` as variable
    - `onSuccess`: invalidate `['vocabulary']` queries

    **5. Create useVocabularyDetail hook** (`frontend/src/features/vocabulary/api/useVocabularyDetail.ts`):
    - Parameters: `id: number | null`
    - Query key: `['vocabulary', id]`
    - Query function: GET `/api/vocabulary/{id}`
    - `enabled: id !== null`
    - Returns `useQuery<LemmaDetailDTO>`
    - Used by edit modal to load full lemma detail (with inflections)

    **6. Create reusable Modal component** (`frontend/src/components/ui/Modal.tsx`):
    - Props: `isOpen: boolean`, `onClose: () => void`, `title: string`, `children: ReactNode`, optional `size?: 'sm' | 'md' | 'lg'`
    - Use native HTML `<dialog>` element OR a div overlay pattern
    - Overlay: fixed position, semi-transparent backdrop, centered content
    - Close on backdrop click and Escape key
    - Prevent body scroll when open (add/remove overflow-hidden on body)
    - Responsive: full-width on mobile with padding, max-width on desktop
    - Header with title and X close button
    - Content area for children
    - Tailwind classes: `fixed inset-0 z-50`, backdrop `bg-black/50`, content `bg-white rounded-lg shadow-xl`
    - Sizes: sm (max-w-md), md (max-w-lg), lg (max-w-2xl)
  </action>
  <verify>
    cd /Users/kevin/projects/bulgarian-vocabulary/frontend && npx tsc --noEmit 2>&1 | tail -10
    # No type errors
  </verify>
  <done>
    Zod schemas validate create and update form data with proper constraints matching backend validation. TanStack Query mutations for create/update/delete all invalidate vocabulary queries on success. useVocabularyDetail fetches full lemma data for edit form pre-population. Reusable Modal component provides overlay dialog with backdrop, close button, and responsive sizing.
  </done>
</task>

<task type="auto">
  <name>Task 2: VocabularyForm, CreateModal, EditModal, and DeleteConfirmDialog</name>
  <files>
    frontend/src/features/vocabulary/components/VocabularyForm.tsx
    frontend/src/features/vocabulary/components/CreateVocabularyModal.tsx
    frontend/src/features/vocabulary/components/EditVocabularyModal.tsx
    frontend/src/features/vocabulary/components/DeleteConfirmDialog.tsx
  </files>
  <action>
    **1. Create VocabularyForm component** (`frontend/src/features/vocabulary/components/VocabularyForm.tsx`):
    - Reusable form for both create and edit modes
    - Props: `mode: 'create' | 'edit'`, `defaultValues?: Partial<CreateVocabularyFormData | UpdateVocabularyFormData>`, `onSubmit: (data: any) => Promise<void>`, `isSubmitting: boolean`, `onCancel: () => void`
    - Uses `useForm` with `zodResolver`:
      - Create mode: uses `createVocabularySchema`
      - Edit mode: uses `updateVocabularySchema`
    - Fields:
      - **Create mode**: "Bulgarian Word" (wordForm) -- input with `lang="bg"`, placeholder "Enter Bulgarian word or phrase"
      - **Edit mode**: "Lemma Text" (text) -- input with `lang="bg"`, placeholder "Canonical lemma form"
      - "English Translation" (translation) -- input, placeholder "Enter English translation"
      - "Notes" (notes) -- textarea, placeholder "Optional notes..."
      - **Edit mode only**: Inflections section:
        - List of inflection rows with "Form" input (`lang="bg"`) and "Grammatical Info" input
        - "Add Inflection" button to append empty row
        - Remove button (X) on each row to delete inflection
        - Use `useFieldArray` from react-hook-form for dynamic inflection list
    - Submit button: "Create Vocabulary" (create) / "Save Changes" (edit)
    - Cancel button
    - Error messages below each field when validation fails
    - Disable submit while isSubmitting
    - Tailwind styling: vertical form layout with proper spacing, labels, input borders, error styling

    **2. Create CreateVocabularyModal** (`frontend/src/features/vocabulary/components/CreateVocabularyModal.tsx`):
    - Reads `isCreateModalOpen` and `closeCreateModal` from Zustand store
    - Uses Modal component with title "Add Vocabulary"
    - Renders VocabularyForm in create mode
    - onSubmit: calls `useCreateVocabulary().mutateAsync(data)`
    - On success: close modal (the mutation's onSuccess already invalidates queries)
    - On error: show error message (from mutation error state)
    - Note: The backend POST /api/vocabulary is async (LLM processing) -- show a "Processing with LLM..." message while mutation is pending, since it can take 1-3 seconds

    **3. Create EditVocabularyModal** (`frontend/src/features/vocabulary/components/EditVocabularyModal.tsx`):
    - Reads `isEditModalOpen`, `editingLemmaId`, `closeEditModal` from Zustand store
    - Uses `useVocabularyDetail(editingLemmaId)` to load full lemma data (with inflections)
    - Shows loading spinner while fetching detail
    - Uses Modal component with title "Edit Vocabulary"
    - Renders VocabularyForm in edit mode with defaultValues from fetched detail:
      - Map `LemmaDetailDTO` to `UpdateVocabularyFormData`: `{ text, translation, notes, inflections: inflections.map(i => ({ id: i.id, form: i.form, grammaticalInfo: i.grammaticalInfo })) }`
    - onSubmit: calls `useUpdateVocabulary().mutateAsync({ id: editingLemmaId, data })`
    - On success: close modal
    - On error: show error message

    **4. Create DeleteConfirmDialog** (`frontend/src/features/vocabulary/components/DeleteConfirmDialog.tsx`):
    - Reads `isDeleteConfirmOpen`, `deletingLemmaId`, `closeDeleteConfirm` from Zustand store
    - Uses Modal component with title "Delete Vocabulary" and size "sm"
    - Confirmation message: "Are you sure you want to delete this vocabulary entry? This action cannot be undone."
    - Two buttons: "Cancel" (secondary, calls closeDeleteConfirm) and "Delete" (danger/red, calls mutation)
    - Uses `useDeleteVocabulary().mutateAsync(deletingLemmaId)`
    - On success: close dialog
    - Delete button shows loading state during mutation
    - Tailwind: danger button with red background

    **Note:** These modals need to be rendered in App.tsx (or VocabularyList.tsx) so they're available globally. Add CreateVocabularyModal, EditVocabularyModal, and DeleteConfirmDialog to the component tree -- they self-manage visibility via Zustand store. Update App.tsx or VocabularyList (if it exists from Plan 02) to include these modal components at the end of the JSX.

    If Plan 02 has already been executed, add the modals to VocabularyList.tsx. If not, add them to App.tsx and they'll be moved/kept when Plan 02 runs.
  </action>
  <verify>
    cd /Users/kevin/projects/bulgarian-vocabulary/frontend && npx tsc --noEmit 2>&1 | tail -10
    # No type errors

    cd /Users/kevin/projects/bulgarian-vocabulary/frontend && npm run build 2>&1 | tail -5
    # Build succeeds
  </verify>
  <done>
    VocabularyForm renders create mode (wordForm field) and edit mode (text + inflections fields) with Zod validation. CreateVocabularyModal opens from Zustand state, submits to backend, shows LLM processing status, closes on success. EditVocabularyModal loads full lemma detail, pre-populates form with inflections, saves changes. DeleteConfirmDialog confirms deletion with danger styling. All modals invalidate queries on success for fresh data. Forms show validation errors for empty required fields.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds in frontend/
2. `npx tsc --noEmit` passes in frontend/
3. Create modal opens, validates form, submits to POST /api/vocabulary, closes on success
4. Edit modal loads lemma detail, pre-populates form with inflections, saves via PUT
5. Delete dialog confirms and calls DELETE /api/vocabulary/{id}
6. All mutations invalidate vocabulary queries after success
7. Form shows validation errors for empty wordForm/text and translation
8. Inflection list in edit form supports add/remove rows
</verification>

<success_criteria>
- User can create vocabulary via modal form with validation
- User can edit vocabulary with pre-populated form including inflections
- User can delete vocabulary with confirmation dialog
- Form validation prevents empty submissions
- Successful CRUD operations refresh the vocabulary list
- Forms handle loading/error states gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-foundation-vocabulary-ui/05-03-SUMMARY.md`
</output>
